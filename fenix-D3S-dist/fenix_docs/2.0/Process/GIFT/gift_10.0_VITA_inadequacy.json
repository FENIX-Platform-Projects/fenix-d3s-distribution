[
  {
    "name": "gift_population_filter",
    "sid": [ { "uid": "GIFT_afc_000042BUR201001" } ],
    "parameters": {
      "item": "VITA",
      "gender": null,
      "special_condition": ["1","2","3","4"],
      "age_year": {
        "from": 0,
        "to": 120
      }
    }
  },

  {
    "name": "filter",
    "parameters": {
      "columns": [
        "subject",
        "value",
        "suggested_value",
        "um"
      ],
      "rows": {
        "age_year": {
          "number": [
            {
              "from": 1
            }
          ]
        }
      }
    }
  },

  {
    "name": "group",
    "rid" : { "uid" : "subjects_data" },
    "parameters": {
      "by": [
        "subject"
      ],
      "aggregations": [
        {
          "columns": [ "value" ],
          "rule": "SUM"
        },
        {
          "columns": [ "suggested_value" ],
          "rule": "MAX"
        },
        {
          "columns": [ "um" ],
          "rule": "MAX"
        }
      ]
    }
  },


  {
    "name" : "select",
    "parameters" : {
      "values" : {
        "value" : "count(*)"
      }
    }
  },

  {
    "name" : "var",
    "result" : false,
    "parameters" : {
      "global" : true,
      "variables" : [
        {
          "key" : "populationSize",
          "type" : "id",
          "value" : "value"
        }
      ]
    }
  },



  {
    "name" : "select",
    "sid" : [{ "uid" : "subjects_data" }],
    "parameters" : {
      "values" : {
        "value" : "(count(*)*100.0)/case when <<populationSize[0]>>=0 then 1 else <<populationSize[0]>> end"
      },
      "query" : "where value<suggested_value having <<populationSize[0]>>>0"
    }
  },

  {
    "name": "addcolumn",
    "parameters": {
      "column": {
        "dataType": "code",
        "title": {
          "EN": "Unit of measure"
        },
        "domain": {
          "codes": [
            {
              "idCodeList": "GIFT_UM"
            }
          ]
        },
        "subject": "um",
        "id": "um"
      },
      "value": "perc"
    }
  }

]