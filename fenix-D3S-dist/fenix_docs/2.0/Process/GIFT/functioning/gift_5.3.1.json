[
  {
    "name": "filter",
    "sid" : [{"uid":"gift_process_food_consumption_000042BUR201001"}],
    "rid" : {"uid" : "consumption_raw"},
    "parameters": {
      "columns": [
        "subject",
        "survey_day",
        "foodex2_code",
        "value",
        "increment",
        "um"
      ],
      "rows": {
        "item": {
          "codes": [
            {
              "uid": "GIFT_Items",
              "codes": [ "FOOD_AMOUNT_PROC" ]
            }
          ]
        },
        "subgroup_code": {
          "codes": [
            {
              "uid": "GIFT_FoodGroups",
              "codes": [ "0104" ]
            }
          ]
        }
      }
    }
  },

  {
    "name": "group",
    "rid" : {"uid" : "consumption_amount"},
    "parameters": {
      "by": [
        "foodex2_code"
      ],
      "aggregations": [
        {
          "columns": [ "value" ],
          "rule": "SUM"
        },
        {
          "columns": [ "um" ],
          "rule": "MAX"
        }
      ]
    }
  },


  {
    "name": "group",
    "sid" : [{"uid" : "consumption_raw"}],
    "parameters": {
      "by": [
        "subject",
        "survey_day",
        "foodex2_code"
      ],
      "aggregations": [
        {
          "columns": [ "increment" ],
          "rule": "MAX"
        }
      ]
    }
  },
  {
    "name": "group",
    "rid" : {"uid" : "consumption_count"},
    "parameters": {
      "by": [
        "foodex2_code"
      ],
      "aggregations": [
        {
          "columns": [ "increment" ],
          "rule": "SUM"
        }
      ]
    }
  },


  {
    "name": "join",
    "sid": [
      { "uid": "consumption_amount" },
      { "uid": "consumption_count" }
    ],
    "parameters": {
      "joins": [
        [ { "type": "id", "value": "foodex2_code" } ],
        [ { "type": "id", "value": "foodex2_code" } ]
      ],
      "values": []
    }
  },



  {
    "name" : "select",
    "parameters" : {
      "values" : {
        "foodex2_code" : null,
        "consumption_amount_value" : "consumption_amount_value/consumption_count_increment",
        "consumption_amount_um" : null
      }
    }
  }


]